<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <!-- <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
        crossorigin="anonymous">
    
    <script src="https://cdn.bootcss.com/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://cdn.bootcss.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script> -->
        
</head>

<body>
    <div class="container">
        <div class="row">
            <h2>下面是今天统计图</h2>
            <table class="table table-striped" id="myTable">
                <thead>
                    <tr>
                        <th scope="col">ID</th>
                        <th scope="col">First</th>
                        <th scope="col">Last</th>
                        <th scope="col">Handle</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th scope="row">1</th>
                        <td>Mark</td>
                        <td>Otto</td>
                        <td>@mdo</td>
                    </tr>
                    <tr>
                        <th scope="row">2</th>
                        <td>Jacob</td>
                        <td>Thornton</td>
                        <td>@fat</td>
                    </tr>
                    <tr>
                        <th scope="row">3</th>
                        <td>Larry</td>
                        <td>the Bird</td>
                        <td>@twitter</td>
                    </tr>
                </tbody>
            </table>

            
            
            <div id="mainId2" class="uploadPdf" style="width: 600px;height:300px;"></div>
            <!-- <div id="mainId3" class="uploadPdf" style="width: 600px;height:900px;"></div>
            <div id="mainId" class="uploadPdf" style="width: 600px;height:900px;"></div> -->
            <div id="mainId4" class="uploadPdf" style="width: 600px;height:300px;"></div> 
            <div id="mainId5" class="uploadPdf" style="width: 600px;height:300px;"></div>
            <p class="uploadPdf">你好你是谁</p>
            <p class="uploadPdf">你好你好你是谁你好你是谁你好你是谁你好你是谁你好你是谁你好你是谁你好你是谁你好你是谁你好你是谁你好你是谁你好你是谁你是谁</p>
            <div id="mainId6" class="uploadPdf" style="width: 600px;height:300px;"></div>
            <div id="mainId9" class="uploadPdf" style="width: 600px;height:700px;"></div>
            <div id="mainId12" class="uploadPdf" style="width: 600px;height:400px;"></div>
            <p class="uploadPdf">你好你是谁</p>
            <div id="mainId2" class="uploadPdf" style="width: 600px;height:300px;"></div>
            <!-- <div id="mainId3" class="uploadPdf" style="width: 600px;height:900px;"></div>
            <div id="mainId" class="uploadPdf" style="width: 600px;height:900px;"></div> -->
            <div id="mainId4" class="uploadPdf" style="width: 600px;height:300px;"></div> 
            <div id="mainId5" class="uploadPdf" style="width: 600px;height:300px;"></div>
            <p class="uploadPdf">你好你是谁</p>
            <p class="uploadPdf">你好你好你是谁你好你是谁你好你是谁你好你是谁你好你是谁你好你是谁你好你是谁你好你是谁你好你是谁你好你是谁你好你是谁你是谁</p>
            <div id="mainId6" class="uploadPdf" style="width: 600px;height:300px;"></div>
            <div id="mainId9" class="uploadPdf" style="width: 600px;height:700px;"></div>
            <div id="mainId12" class="uploadPdf" style="width: 600px;height:400px;"></div>
            <p class="uploadPdf">你好你是谁</p>
            
            
            <!-- <div id="mainId2" class="uploadPdf" style="width: 600px;height:300px;"></div>
            <div id="mainId3" class="uploadPdf" style="width: 600px;height:300px;"></div>
            <div id="mainId4" class="uploadPdf" style="width: 600px;height:300px;"></div>
            <div id="mainId5" class="uploadPdf" style="width: 600px;height:300px;"></div>
            <div id="mainId6" class="uploadPdf" style="width: 600px;height:300px;"></div>
            <div id="mainId7" class="uploadPdf" style="width: 600px;height:300px;"></div>
            <div id="mainId8" class="uploadPdf" style="width: 600px;height:300px;"></div>
            <div id="mainId9" class="uploadPdf" style="width: 600px;height:300px;"></div>
            <div id="mainId10" class="uploadPdf" style="width: 600px;height:300px;"></div>
            <div id="mainId11" class="uploadPdf" style="width: 600px;height:300px;"></div>
            <div id="mainId12" class="uploadPdf" style="width: 600px;height:300px;"></div> -->
            <button class="btn btn-primary" onclick="exportPDF()">导出表格</button>
        </div>
    </div>

</body>

</html>
<script src="./pdfMake/pdfmake.js"></script>
<script src="./pdfMake/vfs_fonts.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/4.1.0.rc2/echarts-en.common.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.5.0-beta4/html2canvas.js"></script>
<!-- <script src="https://cdn.bootcss.com/jspdf/1.3.5/jspdf.debug.js"></script> -->
<!-- <script src="https://cdn.bootcss.com/jspdf-autotable/3.0.0-alpha.1/jspdf.plugin.autotable.min.js"></script> -->
<script>

      
    
    function getFullCanvasDataURL (divId) {
      // 将第一个画布作为基准。
      var baseCanvas = $('#' + divId).find('canvas').first()[0]
      if (!baseCanvas) {
        return false
      };
      var width = baseCanvas.width
      var height = baseCanvas.height
      var ctx = baseCanvas.getContext('2d')
      // 遍历，将后续的画布添加到在第一个上
      $('#' + divId).find('canvas').each(function (i, canvasObj) {
        if (i > 0) {
          var canvasTmp = $(canvasObj)[0]
          ctx.drawImage(canvasTmp, 0, 0, width, height)
        }
      })
      // 获取base64位的url
      return baseCanvas.toDataURL()
    }
    var url = '',url2='',url3=''
    var aryAry = []
    var tts = []

    function tu () {
      var option = {
        legend: {},
        tooltip: {},
        dataset: {
          dimensions: ['product', '2015', '2016', '2017'],
          source: [
            {product: 'Matcha Latte', '2015': 43.3, '2016': 85.8, '2017': 93.7},
            {product: 'Milk Tea', '2015': 83.1, '2016': 73.4, '2017': 55.1},
            {product: 'Cheese Cocoa', '2015': 86.4, '2016': 65.2, '2017': 82.5},
            {product: 'Walnut Brownie', '2015': 72.4, '2016': 53.9, '2017': 39.1}
          ]
        },
        xAxis: {type: 'category'},
        yAxis: {},
        // Declare several bar series, each will be mapped
        // to a column of dataset.source by default.
        series: [
          {type: 'bar'},
          {type: 'bar'},
          {type: 'bar'}
        ]
      }

      var divList = $('.uploadPdf')
     
      for(var i=0;i<divList.length;i++){
        console.log(divList[i].id)
          if(!divList[i].id){
            let objc = {}
            objc['text']=divList[i].innerText
            tts.push(objc)
          }else{
            echarts.init(document.getElementById(divList[i].id)).setOption(option)
            let tt = echarts.init(document.getElementById(divList[i].id))
            tts.push(tt)
          }
          
      }
      // let myChart1 = echarts.init(document.getElementById('mainId'))
      // let myChart2 = echarts.init(document.getElementById('mainId2'))
      // let myChart3 = echarts.init(document.getElementById('mainId3'))\
      

      // 使用刚指定的配置项和数据显示图表。
      // myChart1.setOption(option)
      // myChart2.setOption(option)
      // myChart3.setOption(option)
      // setTimeout(()=>{
      //   for(var i=0;i<tts.length;i++){
      //     let obj2 = {}
      //     let obj3 = {}
      //     if(tts[i].text){
      //       obj3.text = tts[i].text
      //       aryAry.push(obj3)
      //     }else{
      //       obj2.image = tts[i].getDataURL()
      //       aryAry.push(obj2)
      //     }
         
          
      //   }
      //   console.log(aryAry)
      //   // url = myChart1.getDataURL()
      //   // url2 = myChart2.getDataURL()
      //   // url3 = myChart3.getDataURL()
      //   // console.log(url)
      // },10000)
      
     
    }
    
    tu()
console.log('tts::::',tts)

    // tu('mainId3')
    // tu('mainId4')
    // tu('mainId5')
    // tu('mainId6')
    // tu('mainId7')
    // tu('mainId8')
    // tu('mainId9')
    // tu('mainId10')
    // tu('mainId11')
    // tu('mainId12')
    function getBarBase64(id){
        let picAdr = this.getFullCanvasDataURL(id)
        return picAdr
    }

    function exportPDF() {

        for(var i=0;i<tts.length;i++){
            let obj2 = {}
            let obj3 = {}
            if(tts[i].text){
              obj3.text = tts[i].text
              aryAry.push(obj3)
            }else{
              obj2.image = tts[i].getDataURL()
              aryAry.push(obj2)
            }
                  
        }
        console.log('tts::::',tts)
        console.log('aryAry:::',aryAry)
        let text = {
        content:aryAry,
        styles: {
          header: {
            bold: true
          },
          title: {
            fontSize: 13,
            color: '#42A9F4'
          },
          lineImagePosition: {
            margin: [ 0, 5, 0, 0 ]
          },
          anotherStyle: {
            italic: true,
            alignment: 'right'
          },
          marginTop: {
            margin: [ 0, 10, 0, 0 ]
          }
        },
        defaultStyle: {
          font: '微软雅黑'
        },
        background: '360安全'
      }

      pdfMake.fonts = {
        微软雅黑: {
          normal: '求福楷体.ttf',
          bold: '求福楷体.ttf',
          italics: '求福楷体.ttf',
          bolditalics: '求福楷体.ttf'
        }
      }
      // 生成的pdf会下载到本地
      aryAry=[]
      pdfMake.createPdf(text).download()
    }
</script>